<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>星辰所向 耀芒航道</title>
        <style>
            /* 基础样式 */
            html, body {
                margin: 0;
                padding: 0;
                width: 100%;
                min-height: 100vh;
                background-color: #f5f5f5;
            }

            /* 修复弹窗显示时页面内容移动问题 */
            html {
                width: 100%;
                /* 始终显示滚动条，防止弹窗显示时页面抖动 */
                overflow-y: scroll;
            }

            /* 当弹窗打开时，禁止滚动但保持页面布局不变 */
            body.modal-open {
                overflow: hidden;
                /* 不添加额外的padding，避免页面移动 */
            }

            /* 弹窗背景固定宽度，避免页面移动 */
            .modal-bg {
                width: 100vw; /* 使用视口宽度单位 */
            }

            /* 主容器 */
            .main-container {
                width: 100%;
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                box-sizing: border-box;
            }

            /* 默认样式（大屏幕） */
            body {
                font-family: sans-serif;
                text-align: center;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            body > h2 {
                padding: 20px 0;
                margin: 0;
                width: 100%;
                max-width: 1200px;
            }

            /* 通用按钮样式 */
            .blue-btn {
                background: #007bff;
                color: #fff;
                border: none;
                border-radius: 4px;
                padding: 8px 14px;
                margin: 5px;
                font-size: 16px;
                cursor: pointer;
                min-width: 120px;
                box-sizing: border-box;
            }
            .blue-btn:hover {
                opacity: 0.9;
            }

            .green-btn {
                background: #dd7a2a;
                color: #fff;
                border: none;
                border-radius: 4px;
                padding: 8px 14px;
                margin: 5px;
                font-size: 16px;
                cursor: pointer;
                min-width: 120px;
            }
            .green-btn:hover {
                opacity: 0.9;
            }

            .orange-btn {
                background: #ff6600;
                color: #fff;
                border: none;
                border-radius: 4px;
                padding: 8px 14px;
                margin: 5px;
                font-size: 16px;
                cursor: pointer;
                min-width: 120px;
                box-sizing: border-box;
            }
            .orange-btn:hover {
                opacity: 0.9;
            }

            .red-btn {
                background: #ff0000;
                color: #fff;
                border: none;
                border-radius: 4px;
                padding: 4px 8px;
                margin: 0 2px;
                font-size: 14px;
                cursor: pointer;
                min-width: 80px;
            }
            .red-btn:hover {
                opacity: 0.9;
            }

            .small-btn {
                padding: 4px 8px;
                margin: 0 5px;
                font-size: 14px;
                background: #007bff;
                color: #fff;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                min-width: 80px;
            }

            /* 购买钥匙区域 */
            .keys-buy-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                margin: 10px auto;
                max-width: 800px;
                width: 100%;
                box-sizing: border-box;
                padding: 0 15px;
            }

            /* 购买钥匙按钮渐变样式 */
            .keys-buy-container .blue-btn {
                width: 100%;
                margin: 0;
                height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 16px;
                box-sizing: border-box;
                background: linear-gradient(135deg, #0062cc, #1e90ff, #00bfff);
                background-size: 200% 200%;
                animation: gradientAnimation 3s ease infinite;
                border-radius: 6px;
                box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
                transition: all 0.3s ease;
                border: none;
                font-weight: 500;
                letter-spacing: 0.5px;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            }
            
            .keys-buy-container .blue-btn:hover {
                opacity: 1;
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(0, 123, 255, 0.4);
                background-size: 150% 150%;
            }
            
            .keys-buy-container .blue-btn:active {
                transform: translateY(1px);
                box-shadow: 0 2px 4px rgba(0, 123, 255, 0.3);
            }
            
            @keyframes gradientAnimation {
                0% {
                    background-position: 0% 50%;
                }
                50% {
                    background-position: 100% 50%;
                }
                100% {
                    background-position: 0% 50%;
                }
            }
            
            /* 媒体查询 - 平板 */
            @media (max-width: 768px) {
                /* ... existing code ... */
                
                .keys-buy-container .blue-btn {
                    height: 40px;
                    font-size: 14px;
                    border-radius: 5px;
                }
            }
            
            /* 媒体查询 - 手机 */
            @media (max-width: 480px) {
                /* ... existing code ... */
                
                .keys-buy-container .blue-btn {
                    height: 36px;
                    font-size: 12px;
                    border-radius: 4px;
                    letter-spacing: 0;
                }
            }

            /* 统计信息 */
            .stats {
                margin: 20px auto;
                padding: 10px 20px;
                background-color: #f0f8ff;
                border: 2px solid #007bff;
                border-radius: 8px;
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(2, auto);
                gap: 10px;
                max-width: 800px;
                width: 100%;
                box-sizing: border-box;
                font-size: 18px;
                color: #333;
            }
            .stats span {
                margin: 0;
                white-space: nowrap;
                display: flex;
                align-items: center;
                justify-content: center;
                box-sizing: border-box;
                position: relative;
                padding: 5px;
            }
            .stat-label {
                display: inline-block;
                white-space: nowrap;
                margin-right: 5px;
                flex-shrink: 0;
            }
            .stats strong {
                color: #007bff;
                font-size: 20px;
                display: inline-block;
                min-width: 50px;
                text-align: right;
                margin-left: 5px;
                box-sizing: border-box;
                flex-shrink: 0;
            }

            /* 主奖池容器 + 道具 */
            .prize-container {
                margin: 20px auto;
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                justify-content: center;
                max-width: 1000px;
                width: 100%;
                box-sizing: border-box;
            }
            .prize-item {
                position: relative;
                width: 225px;
                height: 70px;
                border: 1px solid #ccc;
                border-radius: 5px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 5px;
                font-size: 16px;
                background: #fafafa;
                overflow: hidden;
            }

            /* 左上角标签容器（横向排列） */
            .label-container {
                position: absolute;
                top: 0;
                left: 0;
                margin: 4px;
                display: flex;
                flex-direction: row;
                gap: 4px;
                flex-wrap: wrap;
            }
            .item-label {
                background: #007bff;
                color: #fff;
                border-radius: 3px;
                padding: 2px 6px;
                font-size: 12px;
                line-height: 1.2;
            }

            /* 暂存箱 */
            .stash-container {
                margin: 20px auto;
                text-align: center;
                overflow-x: auto;
                max-width: 1000px;
                width: 100%;
            }
            .stash-container h3 {
                font-size: 22px;
                margin-bottom: 10px;
            }
            .stash-table {
                width: 100%;
                min-width: 600px;
                margin: 0 auto;
                table-layout: fixed;
                border-collapse: collapse;
                border: 1px solid #4a76b5;
            }
            .stash-table th {
                background: #4a76b5;
                color: white;
                padding: 10px;
                font-weight: normal;
                border: 1px solid #4a76b5;
            }
            .stash-table th:first-child {
                width: 40%;
            }
            .stash-table th:nth-child(2),
            .stash-table th:nth-child(3),
            .stash-table th:nth-child(4) {
                width: 20%;
            }
            .stash-table td {
                border: 1px solid #ccc;
                padding: 8px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                background-color: white;
            }
            .stash-table .red-btn {
                background-color: #ff3b30;
                color: white;
                border: none;
                border-radius: 4px;
                padding: 4px 8px;
                cursor: pointer;
                min-width: 60px;
            }
            .stash-pagination {
                margin: 10px;
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 10px;
            }
            .stash-pagination .page-nav {
                color: #ff8c00;
                text-decoration: none;
                cursor: pointer;
                font-weight: bold;
            }
            .stash-pagination span {
                color: #666;
            }
            
            /* 暂存箱按钮容器 */
            .stash-buttons-container {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
                margin-bottom: 15px;
                width: 100%;
            }

            .stash-buttons-container .red-btn {
                width: 100%;
                margin: 0;
                background-color: #ff3b30;
                color: white;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            /* 星耀宝箱自选区域 */
            .star-box-section {
                margin: 20px auto;
                text-align: center;
                border: 1px solid #ccc;
                padding: 15px;
                border-radius: 8px;
                max-width: 800px;
                width: 100%;
                box-sizing: border-box;
                background-color: #f9f9f9;
            }
            .star-box-section h4 {
                font-size: 18px;
                margin-bottom: 10px;
                color: #007bff;
            }
            .options-container {
                display: flex;
                justify-content: center;
                flex-wrap: wrap;
                gap: 15px;
                margin: 15px 0;
            }
            .option-box {
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 14px;
                min-width: 120px;
                background-color: #fff;
                padding: 8px 12px;
                border-radius: 6px;
                border: 1px solid #e0e0e0;
            }
            .option-box input {
                transform: scale(1.2);
            }
            .star-box-buttons {
                display: flex;
                justify-content: center;
                gap: 15px;
                margin-top: 15px;
                flex-wrap: wrap;
            }
            .star-box-buttons .green-btn {
                min-width: 120px;
                flex: 1;
                max-width: 200px;
                margin: 0;
            }

            /* 星耀值兑换区域 */
            .star-value-section {
                margin: 20px auto;
                text-align: center;
                padding: 15px;
                border-radius: 8px;
                max-width: 1000px;
                width: 100%;
                box-sizing: border-box;
                background-color: #f9f9f9;
                border: 1px solid #ccc;
            }
            .star-value-section h4 {
                font-size: 18px;
                margin-bottom: 10px;
                color: #007bff;
            }
            .exchange-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
                margin-top: 15px;
                justify-content: center;
            }
            .exchange-grid::after {
                content: "";
                grid-column: 1;
            }
            .exchange-item {
                position: relative;
                border: 1px solid #ddd;
                border-radius: 5px;
                padding: 20px 15px;
                background: #fff;
                text-align: center;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            }
            .exchange-item:last-child {
                grid-column: 1 / span 2;
                justify-self: center;
                max-width: 400px;
                width: 80%;
                padding: 25px 20px;
            }
            .exchange-item:last-child .item-name {
                font-size: 18px;
                margin: 15px 0;
            }
            .exchange-item:last-child .blue-btn {
                max-width: 220px;
                font-size: 17px;
                padding: 10px 15px;
            }
            .exchange-item .item-name {
                margin: 10px 0;
                font-weight: bold;
                color: #333;
            }
            .exchange-item .blue-btn {
                margin-top: 10px;
                width: 100%;
                max-width: 180px;
            }

            /* 礼包记录区域 */
            .gift-history-section {
                margin: 20px auto;
                text-align: center;
                max-width: 1000px;
                width: 100%;
                padding: 15px;
                border-radius: 8px;
                background-color: #f9f9f9;
                box-sizing: border-box;
                border: 1px solid #ccc;
            }
            .gift-history-section h3 {
                font-size: 22px;
                margin-bottom: 15px;
                color: #007bff;
            }
            .history-table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin-bottom: 10px;
                border-radius: 4px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            }
            .history-table {
                width: 100%;
                min-width: 600px;
                margin: 0 auto;
                table-layout: fixed;
                border-collapse: collapse;
                border: 1px solid #4a76b5;
                max-width: 1000px;
            }
            .history-table th {
                background: #4a76b5;
                color: white;
                padding: 10px;
                font-weight: normal;
                border: 1px solid #4a76b5;
            }
            .history-table th:first-child {
                width: 30%;
            }
            .history-table th:nth-child(2) {
                width: 20%;
            }
            .history-table th:nth-child(3) {
                width: 50%;
            }
            .history-table td {
                border: 1px solid #ccc;
                padding: 8px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                font-size: 14px;
                background-color: white;
            }
            .history-pagination {
                margin: 10px 0 0;
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 10px;
            }
            .history-pagination .page-nav {
                color: #ff8c00;
                text-decoration: none;
                cursor: pointer;
                font-weight: bold;
            }
            .history-pagination span {
                color: #666;
            }

            /* 弹窗公共样式(兼容PC/手机) */
            .modal-bg {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 9999;
                opacity: 0;
                transition: opacity 0.3s ease;
                -webkit-overflow-scrolling: touch; /* 增强iOS滚动体验 */
            }
            .modal {
                display: none;
                position: fixed;
                z-index: 10000;
                left: 0;
                right: 0;
                top: 0;
                bottom: 0;
                margin: auto;
                width: 90%;
                max-width: 600px;
                height: fit-content;
                max-height: 90vh;
                background-color: white;
                border-radius: 8px;
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
                padding: 20px;
                text-align: center;
                box-sizing: border-box;
                transition: all 0.3s ease;
                overflow-y: auto; /* 内容过多时可滚动 */
                transform: scale(1);
                /* 确保在所有设备上都能正确居中显示 */
                -webkit-transform: scale(1);
                -moz-transform: scale(1);
                -ms-transform: scale(1);
                -o-transform: scale(1);
            }
            .modal-header {
                font-size: 20px;
                font-weight: bold;
                margin-bottom: 10px;
                color: #007bff;
            }
            .modal-content {
                font-size: 16px;
                line-height: 1.8;
                overflow-y: auto;
                max-height: 70vh;
                padding: 5px;
                -webkit-overflow-scrolling: touch; /* 增强iOS滚动体验 */
            }
            .modal-footer {
                margin-top: 15px;
            }
            .modal-footer button {
                background: #007bff;
                color: #fff;
                border: none;
                border-radius: 4px;
                padding: 8px 20px;
                font-size: 16px;
                cursor: pointer;
                min-width: 100px;
                transition: background-color 0.2s ease;
            }
            .modal-footer button:hover {
                opacity: 0.9;
                background-color: #0069d9;
            }
            .prize-card-line {
                margin: 6px 0;
                padding: 5px;
                border-bottom: 1px dashed #eee;
            }
            .prize-card-line:last-child {
                border-bottom: none;
            }
            .highlight {
                color: red;
                font-weight: bold;
            }

            /* 小屏幕（平板） */
            @media (max-width: 768px) {
                .main-container {
                    padding: 10px;
                }

                .keys-buy-container,
                .stats,
                .prize-container,
                .stash-container,
                .star-box-section,
                .star-value-section {
                    max-width: 100%;
                }

                .prize-container {
                    display: grid;
                    grid-template-columns: repeat(2, 1fr);
                    grid-gap: 15px;
                    padding: 0 15px;
                    column-gap: 20px;
                }

                .prize-item {
                    width: 100%;
                    height: auto;
                    min-height: 50px;
                    padding: 8px;
                    font-size: 13px;
                    margin: 0;
                    line-height: 1.2;
                }

                .label-container {
                    margin: 2px;
                }

                .item-label {
                    font-size: 10px;
                    padding: 1px 4px;
                }

                .stats {
                    font-size: 14px;
                    padding: 8px 10px;
                    grid-template-columns: repeat(2, 1fr);
                    grid-template-rows: repeat(2, auto);
                    gap: 8px;
                }
                .stats span {
                    min-width: auto;
                    margin: 0;
                    padding: 0 5px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    white-space: nowrap;
                    width: auto;
                }
                .stat-label {
                    margin-right: 3px;
                    flex-shrink: 0;
                }
                .stats strong {
                    font-size: 16px;
                    min-width: 40px;
                    text-align: right;
                    flex-shrink: 0;
                }

                .exchange-item {
                    padding: 15px;
                    flex: 0 0 100%;
                }

                .blue-btn, .green-btn {
                    width: calc(50% - 10px);
                    margin: 5px;
                }

                .red-btn {
                    width: calc(25% - 4px);
                    margin: 2px;
                }

                .keys-buy-container {
                    gap: 15px;
                    column-gap: 20px;
                }

                .keys-buy-container .blue-btn {
                    height: 40px;
                    font-size: 14px;
                }

                .draw-buttons-container {
                    gap: 15px;
                    column-gap: 20px;
                }

                .draw-buttons-container .green-btn {
                    height: 40px;
                    font-size: 14px;
                }

                .stash-buttons-container {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 8px;
                }
                
                .stash-buttons-container .red-btn {
                    font-size: 12px;
                    padding: 5px 3px;
                    min-width: auto;
                }
                
                /* 弹窗样式优化 - 平板 */
                .modal {
                    padding: 15px;
                    width: 95%;
                    max-width: 600px;
                    height: fit-content;
                    max-height: 80vh;
                    left: 0;
                    right: 0;
                    top: 0;
                    bottom: 0;
                    margin: auto;
                }
                .modal-header {
                    font-size: 18px;
                    margin-bottom: 12px;
                }
                .modal-content {
                    font-size: 15px;
                    line-height: 1.6;
                    max-height: 60vh;
                    overflow-y: auto;
                    padding: 8px 5px;
                }
                .modal-content button.blue-btn {
                    min-width: 75px !important;
                    padding: 6px 12px !important;
                    font-size: 14px !important;
                    margin: 0 4px !important;
                }
                .modal-footer {
                    margin-top: 12px;
                }
                .modal-footer button {
                    padding: 7px 15px;
                    font-size: 15px;
                    min-width: 90px;
                }
                .prize-card-line {
                    margin: 5px 0;
                    padding: 6px 0;
                }

                .stash-container {
                    overflow-x: auto;
                    -webkit-overflow-scrolling: touch;
                    padding-bottom: 5px;
                }
                
                .stash-table {
                    min-width: 100%;
                    width: 100%;
                    font-size: 14px;
                }
                
                .stash-table th,
                .stash-table td {
                    padding: 6px 4px;
                    font-size: 14px;
                    word-break: break-word;
                    white-space: normal;
                }
                
                .stash-table th:first-child {
                    width: 40%;
                }
                
                .stash-table th:nth-child(2),
                .stash-table th:nth-child(3),
                .stash-table th:nth-child(4) {
                    width: 20%;
                }
                
                .stash-table .red-btn {
                    padding: 3px 6px;
                    font-size: 12px;
                    min-width: 45px;
                    width: 100%;
                    max-width: 60px;
                    margin: 0 auto;
                    display: block;
                }

                .stash-buttons-container {
                    gap: 8px;
                }
                
                .stash-buttons-container .red-btn {
                    font-size: 12px;
                    padding: 6px 4px;
                }

                .star-box-section {
                    padding: 12px;
                    margin: 15px auto;
                }
                
                .star-box-section h4 {
                    font-size: 16px;
                }
                
                .options-container {
                    gap: 10px;
                    margin: 12px 0;
                }
                
                .option-box {
                    padding: 6px 10px;
                    font-size: 13px;
                    min-width: 100px;
                }
                
                .star-box-buttons {
                    gap: 10px;
                    margin-top: 12px;
                }
                
                .star-box-buttons .green-btn {
                    min-width: 100px;
                    padding: 8px 5px;
                    font-size: 14px;
                    margin: 0;
                }
                
                .star-value-section {
                    padding: 12px;
                    margin: 15px auto;
                }
                
                .star-value-section h4 {
                    font-size: 16px;
                }

                .exchange-grid {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 15px;
                    margin-top: 12px;
                }
                
                .exchange-item {
                    padding: 15px 10px;
                }
                
                .exchange-item .item-name {
                    margin: 8px 0;
                    font-size: 14px;
                }
                
                .exchange-item .blue-btn {
                    font-size: 14px;
                    padding: 6px 10px;
                    margin-top: 8px;
                }

                .gift-history-section {
                    padding: 12px;
                    margin: 15px auto;
                }
                
                .gift-history-section h3 {
                    font-size: 18px;
                    margin-bottom: 12px;
                }
                
                .history-table-container {
                    margin-bottom: 8px;
                }
                
                .history-table {
                    min-width: 100%;
                    width: 100%;
                    font-size: 14px;
                }
                
                .history-table th,
                .history-table td {
                    padding: 6px 4px;
                    font-size: 14px;
                    word-break: break-word;
                    white-space: normal;
                }
                
                .exchange-item:last-child {
                    max-width: 350px;
                    width: 90%;
                    padding: 20px 15px;
                }
                .exchange-item:last-child .item-name {
                    font-size: 16px;
                    margin: 12px 0;
                }
                .exchange-item:last-child .blue-btn {
                    max-width: 200px;
                    font-size: 15px;
                    padding: 8px 12px;
                }

                .coin-exchange-container {
                    max-width: 100%;
                    padding: 12px;
                    margin: 15px auto;
                }
                
                .coin-exchange-container h3 {
                    font-size: 16px;
                    margin-bottom: 8px;
                }
                
                .coin-exchange-info {
                    margin-bottom: 10px;
                    font-size: 14px;
                }
                
                .coin-exchange-grid {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 12px;
                    margin-top: 10px;
                }
                
                .coin-exchange-item {
                    padding: 12px 8px;
                    min-height: 90px;
                }
                
                .coin-exchange-item .exchange-title {
                    font-size: 10px;
                    padding: 1px 4px;
                    margin: 2px;
                }
                
                .coin-exchange-item .exchange-name {
                    font-size: 13px;
                    margin: 10px 0 8px;
                }
                
                .coin-exchange-item .orange-btn {
                    font-size: 14px;
                    padding: 6px 10px;
                    margin-top: 5px;
                }
                
                .coin-exchange-item:last-child {
                    max-width: none;
                    width: 100%;
                    padding: 12px 8px;
                }
                
                .coin-exchange-item:last-child .orange-btn {
                    max-width: 160px;
                    font-size: 14px;
                }
            }

            /* 更小的屏幕（手机） */
            @media (max-width: 480px) {
                .main-container {
                    padding: 8px;
                }

                .keys-buy-container,
                .stats,
                .prize-container,
                .stash-container,
                .star-box-section,
                .star-value-section {
                    max-width: 100%;
                }

                .prize-container {
                    grid-gap: 12px;
                    padding: 0 15px;
                    column-gap: 15px;
                }

                .prize-item {
                    min-height: 40px;
                    padding: 6px;
                    font-size: 11px;
                    line-height: 1.2;
                    width: 100%;
                    box-sizing: border-box;
                }

                .label-container {
                    margin: 1px;
                }

                .item-label {
                    font-size: 9px;
                    padding: 1px 3px;
                }

                .stats {
                    font-size: 12px;
                    padding: 6px;
                    grid-template-columns: repeat(2, 1fr);
                    grid-template-rows: repeat(2, auto);
                    gap: 6px;
                }
                .stats span {
                    min-width: auto;
                    white-space: nowrap;
                    padding: 0 3px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    width: auto;
                }
                .stat-label {
                    margin-right: 2px;
                    flex-shrink: 0;
                }
                .stats strong {
                    font-size: 14px;
                    min-width: 35px;
                    text-align: right;
                    flex-shrink: 0;
                }

                .exchange-item {
                    padding: 12px 8px;
                }

                .blue-btn, .green-btn {
                    width: 100%;
                    margin: 3px 0;
                }

                .red-btn {
                    width: calc(50% - 4px);
                    margin: 2px;
                }

                .stash-container {
                    overflow-x: auto;
                    -webkit-overflow-scrolling: touch;
                    padding-bottom: 5px;
                }

                .stash-table {
                    min-width: 100%;
                    width: 100%;
                    font-size: 12px;
                }
                
                .stash-table th,
                .stash-table td {
                    padding: 4px 2px;
                    font-size: 12px;
                    word-break: break-word;
                    white-space: normal;
                }
                
                .stash-table th:first-child {
                    width: 40%;
                }
                
                .stash-table th:nth-child(2),
                .stash-table th:nth-child(3),
                .stash-table th:nth-child(4) {
                    width: 20%;
                }
                
                .stash-table .red-btn {
                    padding: 2px 4px;
                    font-size: 11px;
                    min-width: 36px;
                    width: 100%;
                    max-width: 50px;
                    margin: 0 auto;
                    display: block;
                }

                .gift-history-section {
                    padding: 10px;
                    margin: 12px auto;
                }
                
                .gift-history-section h3 {
                    font-size: 16px;
                    margin-bottom: 10px;
                }
                
                .history-table-container {
                    margin-bottom: 8px;
                }

                .history-table {
                    font-size: 12px;
                    min-width: 100%;
                    border-width: 1px;
                }
                
                .history-table th,
                .history-table td {
                    padding: 4px 2px;
                    font-size: 12px;
                    word-break: break-word;
                    white-space: normal;
                    line-height: 1.3;
                }
                
                .history-table th:first-child {
                    width: 35%;
                }
                .history-table th:nth-child(2) {
                    width: 15%;
                }
                .history-table th:nth-child(3) {
                    width: 50%;
                }
                
                .history-pagination {
                    margin-top: 8px;
                    gap: 8px;
                }
                
                .history-pagination .page-nav {
                    font-size: 12px;
                }
                
                .history-pagination span {
                    font-size: 12px;
                }

                .options-container {
                    flex-direction: row;
                    flex-wrap: wrap;
                    justify-content: center;
                    gap: 8px;
                    margin: 10px 0;
                }

                .option-box {
                    padding: 5px 8px;
                    font-size: 12px;
                    min-width: 90px;
                    width: auto;
                }

                .option-box input {
                    transform: scale(1.1);
                }

                .star-box-section {
                    padding: 10px;
                    margin: 12px auto;
                }
                
                .star-box-section h4 {
                    font-size: 15px;
                    margin-bottom: 8px;
                }
                
                .options-container {
                    flex-direction: row;
                    flex-wrap: wrap;
                    justify-content: center;
                    gap: 8px;
                }
                
                .option-box {
                    padding: 5px 8px;
                    font-size: 12px;
                    min-width: 90px;
                    width: auto;
                }
                
                .star-box-buttons {
                    gap: 8px;
                    margin-top: 10px;
                }
                
                .star-box-buttons .green-btn {
                    min-width: 80px;
                    padding: 6px 4px;
                    font-size: 12px;
                    margin: 0;
                }
                
                .star-value-section {
                    padding: 10px;
                    margin: 12px auto;
                }
                
                .star-value-section h4 {
                    font-size: 15px;
                    margin-bottom: 8px;
                }
                
                .exchange-grid {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 10px;
                    margin-top: 10px;
                }
                
                .exchange-item {
                    padding: 12px 8px;
                }
                
                .exchange-item .item-name {
                    margin: 6px 0;
                    font-size: 13px;
                }
                
                .exchange-item .blue-btn {
                    font-size: 12px;
                    padding: 5px 8px;
                    min-width: 80px;
                    margin-top: 6px;
                }
                
                .exchange-item .label-container {
                    margin: 2px;
                }
                
                .exchange-item .item-label {
                    font-size: 9px;
                    padding: 1px 3px;
                }

                .keys-buy-container {
                    gap: 10px;
                    column-gap: 15px;
                }

                .keys-buy-container .blue-btn {
                    height: 36px;
                    font-size: 12px;
                    padding: 6px 10px;
                }
                
                .draw-buttons-container {
                    gap: 10px;
                    column-gap: 15px;
                }

                .draw-buttons-container .green-btn {
                    height: 36px;
                    font-size: 12px;
                    padding: 6px 10px;
                }

                .stash-buttons-container {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 6px;
                }
                
                .stash-buttons-container .red-btn {
                    font-size: 11px;
                    padding: 4px 2px;
                    min-width: auto;
                }
                
                /* 弹窗样式优化 - 手机 */
                .modal {
                    padding: 12px;
                    width: 95%;
                    max-width: 350px;
                    height: fit-content;
                    max-height: 85vh;
                    left: 0;
                    right: 0;
                    top: 0;
                    bottom: 0;
                    margin: auto;
                }
                .modal-header {
                    font-size: 16px;
                    margin-bottom: 8px;
                }
                .modal-content {
                    font-size: 14px;
                    line-height: 1.5;
                    max-height: 50vh;
                    padding: 5px 3px;
                }
                .modal-content button.blue-btn {
                    min-width: 70px !important;
                    padding: 5px 10px !important;
                    font-size: 13px !important;
                    margin: 0 3px !important;
                }
                .modal-footer {
                    margin-top: 10px;
                }
                .modal-footer button {
                    padding: 6px 12px;
                    font-size: 14px;
                    min-width: 80px;
                }
                .prize-card-line {
                    margin: 4px 0;
                    padding: 5px 0;
                }

                .stash-buttons-container {
                    gap: 6px;
                }
                
                .stash-buttons-container .red-btn {
                    font-size: 11px;
                    padding: 5px 2px;
                    min-width: auto;
                }
                
                .exchange-item:last-child {
                    max-width: none;
                    width: 100%;
                    padding: 10px 6px;
                }
                .exchange-item:last-child .item-name {
                    font-size: 14px;
                    margin: 10px 0;
                }
                .exchange-item:last-child .blue-btn {
                    max-width: 180px;
                    font-size: 13px;
                    padding: 6px 10px;
                }

                .coin-exchange-container {
                    padding: 10px;
                    margin: 12px auto;
                }
                
                .coin-exchange-container h3 {
                    font-size: 15px;
                    margin-bottom: 6px;
                }
                
                .coin-exchange-info {
                    margin-bottom: 8px;
                    font-size: 13px;
                }
                
                .coin-exchange-grid {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 8px;
                    margin-top: 8px;
                }
                
                .coin-exchange-item {
                    padding: 10px 6px;
                    min-height: 80px;
                }
                
                .coin-exchange-item .exchange-title {
                    font-size: 9px;
                    padding: 1px 3px;
                    margin: 1px;
                }
                
                .coin-exchange-item .exchange-name {
                    font-size: 11px;
                    margin: 8px 0 5px;
                }
                
                .coin-exchange-item .orange-btn {
                    font-size: 10px;
                    padding: 4px 6px;
                    margin-top: 3px;
                    min-width: 70px;
                }
                
                .coin-exchange-item:last-child {
                    max-width: none;
                    width: 100%;
                    padding: 10px 6px;
                }
                
                .coin-exchange-item:last-child .orange-btn {
                    max-width: 140px;
                    font-size: 10px;
                }
            }

            /* 抽奖按钮容器 */
            .draw-buttons-container {
                    display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                margin: 20px auto;
                max-width: 800px;
                width: 100%;
                padding: 0 15px;
                box-sizing: border-box;
            }

            .draw-buttons-container .green-btn {
                width: 100%;
                margin: 0;
                height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            /* 星辰币兑换区域 */
            .coin-exchange-container {
                margin: 20px auto;
                text-align: center;
                border: 1px solid #ccc;
                padding: 15px;
                border-radius: 8px;
                max-width: 1000px;
                width: 100%;
                box-sizing: border-box;
                background-color: #f9f9f9;
            }
            .coin-exchange-container h3 {
                font-size: 18px;
                margin-bottom: 10px;
                color: #007bff;
            }
            .coin-exchange-info {
                margin-bottom: 15px;
                font-size: 16px;
                color: #333;
            }
            .coin-exchange-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
                margin-top: 15px;
                justify-content: center;
            }
            /* 处理最后一行剩余两个道具居中显示 */
            .coin-exchange-grid::after {
                content: "";
                grid-column: span 2;
            }
            /* 最后两个元素居中 */
            .coin-exchange-grid .coin-exchange-item:nth-last-child(1),
            .coin-exchange-grid .coin-exchange-item:nth-last-child(2) {
                grid-column-start: span 1;
            }
            /* 当只有最后两个元素时，让它们居中 */
            .coin-exchange-grid .coin-exchange-item:nth-last-child(2):nth-child(4n-1) {
                grid-column: 2 / span 1;
            }
            .coin-exchange-grid .coin-exchange-item:nth-last-child(1):nth-child(4n) {
                grid-column: 3 / span 1;
            }
            
            /* 最后两个按钮的包装容器样式 */
            .last-buttons-wrapper {
                grid-column: 1 / -1; /* 跨越所有列 */
                display: flex;
                justify-content: center;
                gap: 20px;
                    margin-top: 10px;
            }
            
            /* 最后两个按钮的样式 */
            .last-buttons-wrapper .coin-exchange-item.small-item {
                width: auto;
                min-width: 200px;
                max-width: 250px;
            }
            
            .coin-exchange-item {
                position: relative;
                border: 1px solid #ddd;
                border-radius: 5px;
                padding: 15px 10px;
                background: #fff;
                text-align: center;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                min-height: 100px;
                width: 100%;
                box-sizing: border-box;
            }
            .coin-exchange-item:last-child {
                grid-column: auto;
                justify-self: auto;
                max-width: none;
                width: 100%;
                padding: 15px 10px;
            }
            .coin-exchange-item .exchange-title {
                position: absolute;
                top: 0;
                left: 0;
                margin: 4px;
                background: #007bff;
                color: #fff;
                border-radius: 3px;
                padding: 2px 6px;
                font-size: 12px;
                line-height: 1.2;
                z-index: 1;
            }
            .coin-exchange-item .exchange-name {
                font-size: 14px;
                color: #333;
                margin: 5px 0 10px;
                font-weight: bold;
            }
            .coin-exchange-item .orange-btn {
                margin-top: 10px;
                width: 100%;
                max-width: 180px;
            }

            /* 平板和手机端保持原有布局 */
            @media (max-width: 768px) {
                .coin-exchange-grid {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 15px;
                }
                
                /* 重置最后两个元素的位置 */
                .coin-exchange-grid .coin-exchange-item:nth-last-child(1),
                .coin-exchange-grid .coin-exchange-item:nth-last-child(2) {
                    grid-column-start: auto;
                }
                
                .coin-exchange-grid .coin-exchange-item:nth-last-child(2):nth-child(4n-1),
                .coin-exchange-grid .coin-exchange-item:nth-last-child(1):nth-child(4n) {
                    grid-column: auto;
                }
                
                /* 重置after伪元素 */
                .coin-exchange-grid::after {
                    content: "";
                    grid-column: 1;
                }
                
                /* 在移动端将最后两个按钮的包装容器改为原始布局 */
                .last-buttons-wrapper {
                    display: contents; /* 使容器的内容直接显示在父元素中，相当于移除容器 */
                }
                
                /* 在移动端重置最后两个按钮的样式为原始样式 */
                .last-buttons-wrapper .coin-exchange-item.small-item {
                    width: 100%;
                    max-width: none;
                    min-width: auto;
                }
            }
            
            @media (max-width: 480px) {
                .coin-exchange-grid {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 8px;
                    margin-top: 8px;
                }
                
                .coin-exchange-item {
                    padding: 10px 6px;
                    min-height: 80px;
                }
                
                .coin-exchange-item .exchange-title {
                    font-size: 9px;
                    padding: 1px 3px;
                    margin: 1px;
                }
                
                .coin-exchange-item .exchange-name {
                    font-size: 11px;
                    margin: 8px 0 5px;
                }
                
                .coin-exchange-item .orange-btn {
                    font-size: 10px;
                    padding: 4px 6px;
                    margin-top: 3px;
                    min-width: 70px;
                }
                
                .coin-exchange-item:last-child {
                    max-width: none;
                    width: 100%;
                    padding: 10px 6px;
                }
                
                .coin-exchange-item:last-child .orange-btn {
                    max-width: 140px;
                    font-size: 10px;
                }
                
                /* 移除手机端对最后两个按钮的特殊处理 */
                .last-buttons-wrapper {
                    gap: 0;
                }
            }

            /* 保底价格弹窗 */
            #guaranteedPriceModalBg {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
                display: none;
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            #guaranteedPriceModal {
                display: none;
                position: fixed;
                z-index: 10000;
                left: 0;
                right: 0;
                top: 0;
                bottom: 0;
                margin: auto;
                width: 90%;
                max-width: 800px;
                height: fit-content;
                max-height: 90vh;
                background: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                overflow-y: auto;
                opacity: 0;
                transition: all 0.3s ease;
                transform: scale(0.9);
                -webkit-transform: scale(0.9);
                -moz-transform: scale(0.9);
                -ms-transform: scale(0.9);
                -o-transform: scale(0.9);
            }
            #guaranteedPriceModal .modal-header {
                padding: 15px;
                background: #007bff;
                color: white;
                font-size: 18px;
                font-weight: bold;
                border-top-left-radius: 8px;
                border-top-right-radius: 8px;
            }
            #guaranteedPriceModal .modal-content {
                padding: 20px;
                max-height: 60vh;
                overflow-y: auto;
            }
            #guaranteedPriceModal .modal-footer {
                padding: 15px;
                text-align: center;
                border-top: 1px solid #eee;
            }
            
            /* 媒体查询 - 平板 */
            @media (max-width: 768px) {
                /* ... existing code ... */
                
                #guaranteedPriceModal {
                    width: 95%;
                    max-width: 600px;
                }
            }
            
            /* 媒体查询 - 手机 */
            @media (max-width: 480px) {
                /* ... existing code ... */
                
                #guaranteedPriceModal {
                    width: 95%;
                    max-width: 350px;
                }
                #guaranteedPriceModal .modal-content {
                    padding: 10px;
                }
            }
        </style>
    </head>
    <body>
        <h2>星辰所向 耀芒航道</h2>
        <div class="main-container">
        <!-- 购买钥匙区域 -->
            <div class="keys-buy-container">
            <button class="blue-btn" onclick="buyKeys(1, 10)">
                10元购买1个钥匙
            </button>
            <button class="blue-btn" onclick="buyKeys(11, 100)">
                100元购买11个钥匙
            </button>
            <button class="blue-btn" onclick="buyKeys(55, 500)">
                500元购买55个钥匙
            </button>
            <button class="blue-btn" onclick="buyKeys(220, 2000)">
                2000元购买220个钥匙
            </button>
        </div>

        <!-- 统计信息 -->
        <div class="stats">
                <span><div class="stat-label">消费金额:</div><strong id="totalMoney">0</strong></span>
                <span><div class="stat-label">抽奖钥匙:</div><strong id="totalKeys">0</strong></span>
                <span><div class="stat-label">我的星辰币:</div><strong id="totalCoins">0</strong></span>
                <span><div class="stat-label">已抽次数:</div><strong id="totalDraws">0</strong></span>
        </div>

        <!-- 主奖池容器 (JS渲染) -->
        <div class="prize-container" id="prizeContainer"></div>

        <!-- 抽奖按钮 -->
            <div class="draw-buttons-container">
            <button class="green-btn" onclick="draw(1)">抽1次</button>
            <button class="green-btn" onclick="draw(10)">抽10次</button>
            <button class="green-btn" onclick="draw(50)">抽50次</button>
            <button class="green-btn" onclick="draw(100)">抽100次</button>
        </div>

        <!-- 暂存箱区域 -->
        <div class="stash-container">
            <h3>暂存箱</h3>
                <div class="stash-buttons-container">
                <button class="red-btn" onclick="batchReceiveCurrentPage()">
                        批量领取当前页
                </button>
                <button class="red-btn" onclick="batchDecomposeCurrentPage()">
                        批量分解当前页
                </button>
                <button class="red-btn" onclick="batchReceiveAll()">
                    全部领取(暂存箱)
                </button>
                <button class="red-btn" onclick="batchDecomposeAll()">
                    全部分解(暂存箱)
                </button>
            </div>
                <div style="overflow-x: auto;">
            <table class="stash-table">
                <thead>
                    <tr>
                        <th>道具名称</th>
                                <th>分解钥匙</th>
                                <th>操作</th>
                                <th>操作</th>
                    </tr>
                </thead>
                <tbody id="stashTableBody"></tbody>
            </table>
                </div>
            <div class="stash-pagination">
                    <a class="page-nav" onclick="stashPrevPage()">上一页</a>
                <span id="stashPageInfo">1/1</span>
                    <a class="page-nav" onclick="stashNextPage()">下一页</a>
                </div>
            </div>

        <!-- 星辰币兑换区域 -->
        <div class="coin-exchange-container">
            <h3>道具兑换</h3>
            <div class="coin-exchange-info">
                <span>我的星辰币: <strong id="totalCoinsDisplay">0</strong></span>
            </div>
            <div class="coin-exchange-grid">
                <div class="coin-exchange-item">
                    <div class="exchange-title">稀有返场</div>
                    <div class="exchange-name">Kar98K-星神</div>
                    <button class="orange-btn" onclick="exchangeStarCoin('Kar98K-星神', 1188)">1188星辰币兑换</button>
                </div>
                <div class="coin-exchange-item">
                    <div class="exchange-title">全新首发</div>
                    <div class="exchange-name">幻神-星耀 皮肤</div>
                    <button class="orange-btn" onclick="exchangeStarCoin('幻神-星耀 皮肤', 958)">958星辰币兑换</button>
                </div>
                <div class="coin-exchange-item">
                    <div class="exchange-title">全新首发</div>
                    <div class="exchange-name">星际战将</div>
                    <button class="orange-btn" onclick="exchangeStarCoin('星际战将', 958)">958星辰币兑换</button>
                </div>
                <div class="coin-exchange-item">
                    <div class="exchange-title">全新首发</div>
                    <div class="exchange-name">毁灭-星耀 皮肤</div>
                    <button class="orange-btn" onclick="exchangeStarCoin('毁灭-星耀 皮肤', 758)">758星辰币兑换</button>
                </div>
                <div class="coin-exchange-item">
                    <div class="exchange-title">不可交易</div>
                    <div class="exchange-name">Kar98K-星神音效卡</div>
                    <button class="orange-btn" onclick="exchangeStarCoin('Kar98K-星神音效卡', 758)">758星辰币兑换</button>
                </div>
                <div class="coin-exchange-item">
                    <div class="exchange-title">全新首发</div>
                    <div class="exchange-name">屠龙-星耀 皮肤</div>
                    <button class="orange-btn" onclick="exchangeStarCoin('屠龙-星耀 皮肤', 558)">558星辰币兑换</button>
                </div>
                <div class="coin-exchange-item">
                    <div class="exchange-name">AN94-超新星</div>
                    <button class="orange-btn" onclick="exchangeStarCoin('AN94-超新星', 278)">278星辰币兑换</button>
                </div>
                <div class="coin-exchange-item">
                    <div class="exchange-name">AK12-天启</div>
                    <button class="orange-btn" onclick="exchangeStarCoin('AK12-天启', 248)">248星辰币兑换</button>
                </div>
                <div class="coin-exchange-item">
                    <div class="exchange-title">不可交易</div>
                    <div class="exchange-name">炼狱-星空 皮肤</div>
                    <button class="orange-btn" onclick="exchangeStarCoin('炼狱-星空 皮肤', 198)">198星辰币兑换</button>
                </div>
                <div class="coin-exchange-item">
                    <div class="exchange-title">不可交易</div>
                    <div class="exchange-name">羊驼玩偶</div>
                    <button class="orange-btn" onclick="exchangeStarCoin('羊驼玩偶', 108)">108星辰币兑换</button>
                </div>
                <div class="coin-exchange-item">
                    <div class="exchange-name">交易专用钥匙x5</div>
                    <button class="orange-btn" onclick="exchangeStarCoin('交易专用钥匙x5', 15)">15星辰币兑换</button>
                </div>
                <div class="coin-exchange-item">
                    <div class="exchange-name">属性变更券x5</div>
                    <button class="orange-btn" onclick="exchangeStarCoin('属性变更券x5', 15)">15星辰币兑换</button>
                </div>
                <!-- 最后两个按钮放在特殊容器中 -->
                <div class="last-buttons-wrapper">
                    <div class="coin-exchange-item small-item">
                        <div class="exchange-name">交易专用钥匙x1</div>
                        <button class="orange-btn" onclick="exchangeStarCoin('交易专用钥匙x1', 3)">3星辰币兑换</button>
                    </div>
                    <div class="coin-exchange-item small-item">
                        <div class="exchange-name">属性变更券x1</div>
                        <button class="orange-btn" onclick="exchangeStarCoin('属性变更券x1', 3)">3星辰币兑换</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 星耀宝箱自选区域 -->
        <div class="star-box-section">
            <h4>星耀宝箱自选</h4>
            <p>可开启的星耀宝箱：<span id="starBoxCount">0</span></p>

            <!-- 三选一 (单选) -->
            <div class="options-container">
                <label class="option-box">
                    <input type="radio" name="starBoxOption" value="xyValue" />
                    <span>星耀值x3</span>
                </label>
                <label class="option-box">
                    <input
                        type="radio"
                        name="starBoxOption"
                        value="kingStone"
                    />
                    <span>王者之石x1</span>
                </label>
                <label class="option-box">
                    <input
                        type="radio"
                        name="starBoxOption"
                        value="universalFrag"
                    />
                    <span>2025万能碎片x3</span>
                </label>
            </div>

            <div class="star-box-buttons">
                <button class="green-btn" onclick="openStarBox(1)">
                    领取1次
                </button>
                <button class="green-btn" onclick="openStarBox(5)">
                    领取5次
                </button>
            </div>
        </div>

        <!-- 星耀值兑换区域 (5个一行) -->
        <div class="star-value-section">
            <h4>星耀值兑换</h4>
            <p>当前星耀值：<span id="starValue">0</span></p>
            <div class="exchange-grid">
                <!-- 1) 星际战将 -->
                <div class="exchange-item">
                    <div class="label-container">
                        <div class="item-label">全新首发</div>
                        <div class="item-label">唯一性角色</div>
                        <div class="item-label">VVIP角色</div>
                    </div>
                    <div class="item-name">星际战将</div>
                    <button
                        class="blue-btn cost-btn"
                        onclick="exchangeStarValue('星际战将',108)"
                    >
                        108星耀值兑换
                    </button>
                </div>

                <!-- 2) 幻神-星耀 皮肤 -->
                <div class="exchange-item">
                    <div class="label-container">
                        <div class="item-label">全新首发</div>
                        <div class="item-label">VVIP武器皮肤</div>
                        <div class="item-label">不可交易</div>
                    </div>
                    <div class="item-name">幻神-星耀 皮肤</div>
                    <button
                        class="blue-btn cost-btn"
                        onclick="exchangeStarValue('幻神-星耀 皮肤',108)"
                    >
                        108星耀值兑换
                    </button>
                </div>

                <!-- 3) 毁灭-星耀 皮肤 -->
                <div class="exchange-item">
                    <div class="label-container">
                        <div class="item-label">全新首发</div>
                        <div class="item-label">VVIP武器皮肤</div>
                        <div class="item-label">不可交易</div>
                    </div>
                    <div class="item-name">毁灭-星耀 皮肤</div>
                    <button
                        class="blue-btn cost-btn"
                        onclick="exchangeStarValue('毁灭-星耀 皮肤',88)"
                    >
                        88星耀值兑换
                    </button>
                </div>

                <!-- 4) 屠龙-星耀 皮肤 -->
                <div class="exchange-item">
                    <div class="label-container">
                        <div class="item-label">全新首发</div>
                        <div class="item-label">VVIP武器皮肤</div>
                        <div class="item-label">不可交易</div>
                    </div>
                    <div class="item-name">屠龙-星耀 皮肤</div>
                    <button
                        class="blue-btn cost-btn"
                        onclick="exchangeStarValue('屠龙-星耀 皮肤',68)"
                    >
                        68星耀值兑换
                    </button>
                </div>

                <!-- 5) 道聚城通用代金券x50 -->
                <div class="exchange-item">
                    <div class="item-name">道聚城通用代金券x50</div>
                    <button
                        class="blue-btn cost-btn"
                        onclick="exchangeStarValue('道聚城通用代金券x50',48)"
                    >
                        48星耀值兑换
                    </button>
                </div>
            </div>
        </div>

        <!-- 礼包记录区域 -->
        <div class="gift-history-section">
        <h3>礼包记录</h3>
            <div class="history-table-container">
                <table class="history-table">
            <thead>
                <tr>
                    <th>时间</th>
                    <th>大区</th>
                    <th>道具</th>
                </tr>
            </thead>
            <tbody id="giftHistoryTableBody"></tbody>
        </table>
            </div>
        <div class="history-pagination">
                <a class="page-nav" onclick="prevGiftPage()">上一页</a>
            <span id="giftPageInfo">1/1</span>
                <a class="page-nav" onclick="nextGiftPage()">下一页</a>
            </div>
        </div>

        <!-- 奖池概率按钮(最下方) -->
        <div style="margin-top: 30px">
            <button class="blue-btn" onclick="openPrizePoolModal()">
                奖池概率
            </button>
            <button class="blue-btn" onclick="openGuaranteedPriceModal()">
                保底价格
            </button>
        </div>

        <!-- 奖池概率弹窗 -->
        <div class="modal-bg" id="prizePoolModalBg"></div>
        <div class="modal" id="prizePoolModal">
            <div class="modal-header">信息</div>
            <div class="modal-content" id="prizePoolModalContent"></div>
            <div class="modal-footer">
                    <button class="blue-btn" onclick="closePrizePoolModal()">关闭</button>
            </div>
        </div>

        <!-- 保底价格弹窗 -->
        <div class="modal-bg" id="guaranteedPriceModalBg"></div>
        <div class="modal" id="guaranteedPriceModal">
            <div class="modal-header">保底价格</div>
            <div class="modal-content" id="guaranteedPriceModalContent"></div>
            <div class="modal-footer">
                    <button class="blue-btn" onclick="closeGuaranteedPriceModal()">关闭</button>
            </div>
        </div>

        <!-- 抽奖结果弹窗 -->
        <div class="modal-bg" id="modalBg"></div>
        <div class="modal" id="modal">
            <div class="modal-header">中奖信息</div>
            <div class="modal-content" id="modalContent"></div>
            <div class="modal-footer">
                    <button class="blue-btn" onclick="closeModal()">确定</button>
            </div>
        </div>

        <!-- 模拟器相关法律提醒 -->
        <div
            style="
                margin-top: 30px;
                padding: 10px;
                text-align: center;
                color: #fa0101;
                font-size: 14px;
                border-top: 1px solid #ccc;
            "
        >
            <p>
                本工具仅供玩家娱乐体验与测试用途，不包含真实游戏数据推送。<br />
                请合理安排游戏时间，理性消费。如有侵权联系即删~
            </p>
            </div>
        </div>

        <script>

        function isMobiles() {
            const userAgentInfo = navigator.userAgent;
            const mobileAgents = ["Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod"];
            const mobileFlag = mobileAgents.some((mobileAgent) => {
                return userAgentInfo.indexOf(mobileAgent) > 0;
            });

            return mobileFlag;
        }
        var isMob = isMobiles()

            /*******************************************
             *   全局变量                              *
             *******************************************/
            let moneySpent = 0; // 消费金额
            let totalKeys = 0; // 抽奖钥匙
            let totalCoins = 0; // 我的星辰币
            let totalDraws = 0; // 已抽次数

            let starBoxCount = 0; // 星耀宝箱数量
            let starValue = 0; // 星耀值

            // 用户IP信息
            let userRegion = "北方大区"; // 默认大区

            /* 奖池数据 */
            const prizePool = [
                {
                    name: "Kar98K-星神",
                    prob: 0.20,
                    keyValue: 12,
                    labels: ["稀有返场"],
                },
                {
                    name: "幻神-星耀 皮肤",
                    prob: 0.25,
                    keyValue: 10,
                    labels: ["全新首发", "VVIP武器皮肤", "不可交易"],
                },
                {
                    name: "星际战将",
                    prob: 0.25,
                    keyValue: 10,
                    labels: ["全新首发", "唯一性角色", "VVIP角色"],
                },
                {
                    name: "Kar98K-星神音效卡",
                    prob: 0.30,
                    keyValue: 8,
                    labels: ["不可交易"],
                },
                {
                    name: "毁灭-星耀 皮肤",
                    prob: 0.30,
                    keyValue: 8,
                    labels: ["全新首发", "VVIP武器皮肤", "不可交易"],
                },
                {
                    name: "屠龙-星耀 皮肤",
                    prob: 0.40,
                    keyValue: 8,
                    labels: ["全新首发", "VVIP武器皮肤", "不可交易"],
                },
                { name: "AN94-超新星", prob: 0.70, keyValue: 3, labels: [] },
                { name: "AK12-天启", prob: 0.80, keyValue: 3, labels: [] },
                {
                    name: "炼狱-星空 皮肤",
                    prob: 1.00,
                    keyValue: 3,
                    labels: ["不可交易"],
                },
                {
                    name: "羊驼玩偶",
                    prob: 1.20,
                    keyValue: 1,
                    labels: ["不可交易"],
                },
                { name: "星耀宝箱", prob: 7.40, keyValue: 0, labels: [] },
                { name: "星辰币x100", prob: 0.20, keyValue: 0, labels: [] },
                { name: "星辰币x15", prob: 2.00, keyValue: 0, labels: [] },
                { name: "星辰币x9", prob: 10.00, keyValue: 0, labels: [] },
                { name: "星辰币x8", prob: 35.00, keyValue: 0, labels: [] },
                { name: "星辰币x7", prob: 40.00, keyValue: 0, labels: [] },
            ];

            /* 暂存箱记录 */
            let stashRecords = []; // { name, keyValue, status: "normal"|"received"|"decomposed" }
            let stashPage = 1;
            const stashPageSize = 10;

            /* 礼包记录 */
            let giftRecords = [];
            let giftCurrentPage = 1;
            const giftPageSize = 10;

            /*******************************************
             *   用户IP和区域                          *
             *******************************************/
            function getUserIPRegion() {
                // 由于无法实际获取用户IP，这里使用模拟数据
                // 在实际应用中，可以使用第三方API获取用户IP和地区信息
                const regions = ["北方大区", "南方大区", "东方大区", "西方大区", "中部大区"];
                const randomIndex = Math.floor(Math.random() * regions.length);
                userRegion = regions[randomIndex];
            }

            /*******************************************
             *   页面初始化                            *
             *******************************************/
            document.addEventListener("DOMContentLoaded", function () {
                // 获取用户IP信息
                getUserIPRegion();
                
                renderPrizeContainer();
                renderStash();
                renderGiftRecords();
                updateStats();
                
                // 初始化星辰币为0
                totalCoins = 0;
                document.getElementById("totalCoins").textContent = totalCoins;
                document.getElementById("totalCoinsDisplay").textContent = totalCoins;
            });

            /*******************************************
             *   渲染奖池 + 左上角标签                *
             *******************************************/
            function renderPrizeContainer() {
                const container = document.getElementById("prizeContainer");
                container.innerHTML = "";
                prizePool.forEach((item) => {
                    const div = document.createElement("div");
                    div.className = "prize-item";

                    // 左上角标签 (横向)
                    let labelHTML = "";
                    if (item.labels && item.labels.length > 0) {
                        // 在手机端只显示第一个标签
                        const labels = window.innerWidth <= 480 ? [item.labels[0]] : item.labels;
                        labelHTML = `
        <div class="label-container">
            ${labels.map((lb) => `<div class="item-label">${lb}</div>`).join("")}
        </div>
      `;
                    }
                    div.innerHTML = labelHTML + item.name;
                    container.appendChild(div);
                });
            }

            // 添加窗口大小改变事件监听
            window.addEventListener('resize', function() {
                renderPrizeContainer();
            });

            /*******************************************
             *   购买钥匙                              *
             *******************************************/
            function buyKeys(keys, price) {
                moneySpent += price;
                totalKeys += keys;
                updateStats();
                // 使用自定义弹窗替代alert
                openResultModal(
                    "购买成功",
                    `消费 ${price} 元，获得 ${keys} 个钥匙`
                );
            }

            /*******************************************
             *   抽奖逻辑                              *
             *******************************************/
            function draw(times) {
                if (totalKeys < times) {
                    // 使用自定义弹窗替代alert
                    openResultModal("提示", "钥匙不足，请先购买！");
                    return;
                }
                totalKeys -= times;
                totalDraws += times;

                let results = [];
                for (let i = 0; i < times; i++) {
                    const item = pickRandomPrize();
                    results.push(item.name);
                    // 若抽到星耀宝箱 => starBoxCount++
                    if (item.name === "星耀宝箱") {
                        starBoxCount++;
                        document.getElementById("starBoxCount").textContent =
                            starBoxCount;
                    }
                    // 统计星辰币
                    if (item.name.includes("星辰币")) {
                        // 提取星辰币数量
                        const coinMatch = item.name.match(/星辰币x(\d+)/);
                        if (coinMatch && coinMatch[1]) {
                            const coinAmount = parseInt(coinMatch[1]);
                            totalCoins += coinAmount;
                            // 更新星辰币显示
                            document.getElementById("totalCoins").textContent = totalCoins;
                            document.getElementById("totalCoinsDisplay").textContent = totalCoins;
                        }
                    }
                    // 记录到礼包记录
                    addGiftRecord(item.name);

                    // 若非星辰币/星耀宝箱 && keyValue>0 => 放入暂存箱
                    if (
                        !item.name.includes("星辰币") &&
                        item.name !== "星耀宝箱" &&
                        item.keyValue > 0
                    ) {
                        stashRecords.unshift({
                            name: item.name,
                            keyValue: item.keyValue,
                            status: "normal",
                        });
                    }
                }

                // 构造弹窗
                let modalHTML = "";
                if (times <= 10) {
                    modalHTML = results
                        .map((r) => {
                            if (!r.includes("星辰币") && r !== "星耀宝箱") {
                                return `<div class="prize-card-line"><span class="highlight">${r}</span></div>`;
                            } else {
                                return `<div class="prize-card-line">${r}</div>`;
                            }
                        })
                        .join("");
                } else {
                    // 聚合
                    let summary = {};
                    results.forEach((r) => {
                        summary[r] = (summary[r] || 0) + 1;
                    });
                    let summaryArr = Object.entries(summary).sort(
                        (a, b) => b[1] - a[1]
                    );
                    if (summaryArr.length > 10)
                        summaryArr = summaryArr.slice(0, 10);
                    modalHTML = `<div style="text-align:center;"><strong>奖品统计：</strong></div>`;
                    summaryArr.forEach(([n, c]) => {
                        if (!n.includes("星辰币") && n !== "星耀宝箱") {
                            modalHTML += `<div class="prize-card-line"><span class="highlight">${n}</span> x ${c}</div>`;
                        } else {
                            modalHTML += `<div class="prize-card-line">${n} x ${c}</div>`;
                        }
                    });
                }

                showModal(modalHTML);
                renderStash();
                updateStats();
            }

            /*******************************************
             *   随机抽奖                             *
             *******************************************/
            function pickRandomPrize() {
                let rand = Math.random() * 100;
                let cumulative = 0;
                for (let item of prizePool) {
                    cumulative += item.prob;
                    if (rand < cumulative) return item;
                }
                return prizePool[prizePool.length - 1];
            }

            /*******************************************
             *   暂存箱                                *
             *******************************************/
            function renderStash() {
                const total = stashRecords.length;
                const totalPages = Math.ceil(total / stashPageSize) || 1;
                stashPage = Math.min(Math.max(stashPage, 1), totalPages);
                const startIndex = (stashPage - 1) * stashPageSize;
                const pageData = stashRecords.slice(
                    startIndex,
                    startIndex + stashPageSize
                );

                let tbody = "";
                pageData.forEach((item, idx) => {
                    const globalIndex = startIndex + idx;
                    let receiveTd, decomposeTd;
                    if (item.status === "normal") {
                        receiveTd = `<button class="red-btn" onclick="stashReceive(${globalIndex})">领取</button>`;
                        decomposeTd = `<button class="red-btn" onclick="stashDecompose(${globalIndex})">分解</button>`;
                    } else if (item.status === "received") {
                        receiveTd = "已领取";
                        decomposeTd = "×";
                    } else {
                        receiveTd = "×";
                        decomposeTd = "已分解";
                    }
                    tbody += `
      <tr>
        <td>${item.name}</td>
        <td>${item.keyValue}</td>
        <td>${receiveTd}</td>
        <td>${decomposeTd}</td>
      </tr>
    `;
                });
                document.getElementById("stashTableBody").innerHTML = tbody;
                document.getElementById(
                    "stashPageInfo"
                ).textContent = `${stashPage}/${totalPages}`;
            }
            function stashPrevPage() {
                stashPage--;
                renderStash();
            }
            function stashNextPage() {
                stashPage++;
                renderStash();
            }
            function stashReceive(index) {
                const item = stashRecords[index];
                if (!item || item.status !== "normal") return;
                
                // 使用自定义弹窗替代confirm
                const modalContent = document.getElementById("modalContent");
                modalContent.innerHTML = `
                    <div style="font-weight:bold;margin-bottom:10px;">确认操作</div>
                    <p>确认将 ${item.name} 发送到仓库吗？</p>
                    <div style="display:flex;justify-content:center;gap:10px;margin-top:15px;">
                        <button id="confirmReceiveBtn" class="blue-btn" style="min-width:80px;padding:6px 12px;margin:0 5px;">确认</button>
                        <button id="cancelReceiveBtn" class="blue-btn" style="background:#999;min-width:80px;padding:6px 12px;margin:0 5px;">取消</button>
                    </div>
                `;
                
                // 设置标题
                document.querySelector("#modal .modal-header").textContent = "领取确认";
                
                // 隐藏原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "none";
                
                // 显示弹窗背景
                const modalBg = document.getElementById("modalBg");
                modalBg.style.display = "block";
                document.body.style.overflow = "hidden"; // 防止背景滚动
                
                setTimeout(() => {
                    modalBg.style.opacity = "1";
                }, 10);
                
                // 显示弹窗并添加动画效果
                const modal = document.getElementById("modal");
                modal.style.display = "block";
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                
                setTimeout(() => {
                    modal.style.opacity = "1";
                    modal.style.transform = "scale(1)";
                    modal.style.webkitTransform = "scale(1)";
                    modal.style.mozTransform = "scale(1)";
                    modal.style.msTransform = "scale(1)";
                    modal.style.oTransform = "scale(1)";
                    
                    // 绑定确认和取消按钮事件
                    document.getElementById("confirmReceiveBtn").onclick = function() {
                        confirmReceive(index);
                    };
                    document.getElementById("cancelReceiveBtn").onclick = closeModal;
                }, 10);
            }

            function confirmReceive(index) {
                // 关闭确认弹窗
                // closeModal();
                
                // 恢复原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "block";
                
                // 执行领取操作
                const item = stashRecords[index];
                if (!item || item.status !== "normal") return;
                
                item.status = "received";
                openResultModal(
                    "领取成功",
                    `恭喜您获得了礼包：${item.name}<br>游戏虚拟道具将会在24小时内到账`
                );
                renderStash();
            }

            function stashDecompose(index) {
                const item = stashRecords[index];
                if (!item || item.status !== "normal") return;
                
                // 使用自定义弹窗替代confirm
                const modalContent = document.getElementById("modalContent");
                modalContent.innerHTML = `
                    <div style="font-weight:bold;margin-bottom:10px;">确认操作</div>
                    <p>确认将 ${item.name} 分解为 ${item.keyValue} 个钥匙吗？</p>
                    <div style="display:flex;justify-content:center;gap:10px;margin-top:15px;">
                        <button id="confirmDecomposeBtn" class="blue-btn" style="min-width:80px;padding:6px 12px;margin:0 5px;">确认</button>
                        <button id="cancelDecomposeBtn" class="blue-btn" style="background:#999;min-width:80px;padding:6px 12px;margin:0 5px;">取消</button>
                    </div>
                `;
                
                // 设置标题
                document.querySelector("#modal .modal-header").textContent = "分解确认";
                
                // 隐藏原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "none";
                
                // 显示弹窗背景
                const modalBg = document.getElementById("modalBg");
                modalBg.style.display = "block";
                document.body.style.overflow = "hidden"; // 防止背景滚动
                
                setTimeout(() => {
                    modalBg.style.opacity = "1";
                }, 10);
                
                // 显示弹窗并添加动画效果
                const modal = document.getElementById("modal");
                modal.style.display = "block";
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                
                setTimeout(() => {
                    modal.style.opacity = "1";
                    modal.style.transform = "scale(1)";
                    modal.style.webkitTransform = "scale(1)";
                    modal.style.mozTransform = "scale(1)";
                    modal.style.msTransform = "scale(1)";
                    modal.style.oTransform = "scale(1)";
                    
                    // 绑定确认和取消按钮事件
                    document.getElementById("confirmDecomposeBtn").onclick = function() {
                        confirmDecompose(index);
                    };
                    document.getElementById("cancelDecomposeBtn").onclick = closeModal;
                }, 10);
            }

            function confirmDecompose(index) {
                // 关闭确认弹窗
                // closeModal();
                
                // 恢复原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "block";
                
                // 执行分解操作
                const item = stashRecords[index];
                if (!item || item.status !== "normal") return;
                
                item.status = "decomposed";
                totalKeys += item.keyValue;
                openResultModal(
                    "分解成功",
                    `成功将 ${item.name} 分解为 ${item.keyValue} 个钥匙`
                );
                updateStats();
                renderStash();
            }

            function batchReceiveCurrentPage() {
                const total = stashRecords.length;
                const totalPages = Math.ceil(total / stashPageSize) || 1;
                stashPage = Math.min(Math.max(stashPage, 1), totalPages);
                const startIndex = (stashPage - 1) * stashPageSize;
                const pageData = stashRecords.slice(
                    startIndex,
                    startIndex + stashPageSize
                );

                // 检查当前页是否有可领取的道具
                let hasReceivable = false;
                pageData.forEach((item) => {
                    if (item.status === "normal") {
                        hasReceivable = true;
                    }
                });
                
                if (!hasReceivable) {
                openResultModal(
                        "提示",
                        "当前页没有可领取的道具"
                    );
                    return;
                }
                
                // 使用自定义弹窗替代confirm
                const modalContent = document.getElementById("modalContent");
                modalContent.innerHTML = `
                    <div style="font-weight:bold;margin-bottom:10px;">确认操作</div>
                    <p>确认批量领取当前页的所有道具吗？</p>
                    <div style="display:flex;justify-content:center;gap:10px;margin-top:15px;">
                        <button id="confirmBatchReceivePageBtn" class="blue-btn" style="min-width:80px;padding:6px 12px;margin:0 5px;">确认</button>
                        <button id="cancelBatchReceivePageBtn" class="blue-btn" style="background:#999;min-width:80px;padding:6px 12px;margin:0 5px;">取消</button>
                    </div>
                `;
                
                // 设置标题
                document.querySelector("#modal .modal-header").textContent = "批量领取确认";
                
                // 隐藏原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "none";
                
                // 显示弹窗背景
                const modalBg = document.getElementById("modalBg");
                modalBg.style.display = "block";
                document.body.style.overflow = "hidden"; // 防止背景滚动
                
                setTimeout(() => {
                    modalBg.style.opacity = "1";
                }, 10);
                
                // 显示弹窗并添加动画效果
                const modal = document.getElementById("modal");
                modal.style.display = "block";
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                
                setTimeout(() => {
                    modal.style.opacity = "1";
                    modal.style.transform = "scale(1)";
                    modal.style.webkitTransform = "scale(1)";
                    modal.style.mozTransform = "scale(1)";
                    modal.style.msTransform = "scale(1)";
                    modal.style.oTransform = "scale(1)";
                    
                    // 绑定确认和取消按钮事件
                    document.getElementById("confirmBatchReceivePageBtn").onclick = confirmBatchReceivePage;
                    document.getElementById("cancelBatchReceivePageBtn").onclick = closeModal;
                }, 10);
            }

            function confirmBatchReceivePage() {
                // 关闭确认弹窗
                // closeModal();
                
                // 恢复原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "block";
                
                // 执行批量领取操作
                const total = stashRecords.length;
                const totalPages = Math.ceil(total / stashPageSize) || 1;
                stashPage = Math.min(Math.max(stashPage, 1), totalPages);
                const startIndex = (stashPage - 1) * stashPageSize;
                const pageData = stashRecords.slice(
                    startIndex,
                    startIndex + stashPageSize
                );

                let count = 0;
                pageData.forEach((item, idx) => {
                    const globalIndex = startIndex + idx;
                    if (item.status === "normal") {
                        stashRecords[globalIndex].status = "received";
                        count++;
                    }
                });
                
                openResultModal(
                    "批量领取成功",
                    `成功领取了 ${count} 个道具，游戏虚拟道具将会在24小时内到账`
                );
                renderStash();
            }

            function batchDecomposeCurrentPage() {
                const total = stashRecords.length;
                const totalPages = Math.ceil(total / stashPageSize) || 1;
                stashPage = Math.min(Math.max(stashPage, 1), totalPages);
                const startIndex = (stashPage - 1) * stashPageSize;
                const pageData = stashRecords.slice(
                    startIndex,
                    startIndex + stashPageSize
                );

                // 检查当前页是否有可分解的道具
                let hasDecomposable = false;
                let keyCount = 0;
                pageData.forEach((item) => {
                    if (item.status === "normal") {
                        hasDecomposable = true;
                        keyCount += item.keyValue;
                    }
                });
                
                if (!hasDecomposable) {
                openResultModal(
                        "提示",
                        "当前页没有可分解的道具"
                    );
                    return;
                }
                
                // 使用自定义弹窗替代confirm
                const modalContent = document.getElementById("modalContent");
                modalContent.innerHTML = `
                    <div style="font-weight:bold;margin-bottom:10px;">确认操作</div>
                    <p>确认批量分解当前页的所有道具吗？<br>预计可获得 ${keyCount} 个钥匙</p>
                    <div style="display:flex;justify-content:center;gap:10px;margin-top:15px;">
                        <button id="confirmBatchDecomposePageBtn" class="blue-btn" style="min-width:80px;padding:6px 12px;margin:0 5px;">确认</button>
                        <button id="cancelBatchDecomposePageBtn" class="blue-btn" style="background:#999;min-width:80px;padding:6px 12px;margin:0 5px;">取消</button>
                    </div>
                `;
                
                // 设置标题
                document.querySelector("#modal .modal-header").textContent = "批量分解确认";
                
                // 隐藏原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "none";
                
                // 显示弹窗背景
                const modalBg = document.getElementById("modalBg");
                modalBg.style.display = "block";
                document.body.style.overflow = "hidden"; // 防止背景滚动
                
                setTimeout(() => {
                    modalBg.style.opacity = "1";
                }, 10);
                
                // 显示弹窗并添加动画效果
                const modal = document.getElementById("modal");
                modal.style.display = "block";
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                
                setTimeout(() => {
                    modal.style.opacity = "1";
                    modal.style.transform = "scale(1)";
                    modal.style.webkitTransform = "scale(1)";
                    modal.style.mozTransform = "scale(1)";
                    modal.style.msTransform = "scale(1)";
                    modal.style.oTransform = "scale(1)";
                    
                    // 绑定确认和取消按钮事件
                    document.getElementById("confirmBatchDecomposePageBtn").onclick = confirmBatchDecomposePage;
                    document.getElementById("cancelBatchDecomposePageBtn").onclick = closeModal;
                }, 10);
            }

            function confirmBatchDecomposePage() {
                // 关闭确认弹窗
                // closeModal();
                
                // 恢复原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "block";
                
                // 执行批量分解操作
                const total = stashRecords.length;
                const totalPages = Math.ceil(total / stashPageSize) || 1;
                stashPage = Math.min(Math.max(stashPage, 1), totalPages);
                const startIndex = (stashPage - 1) * stashPageSize;
                const pageData = stashRecords.slice(
                    startIndex,
                    startIndex + stashPageSize
                );
                
                let count = 0;
                let keyCount = 0;
                pageData.forEach((item, idx) => {
                    const globalIndex = startIndex + idx;
                    if (item.status === "normal") {
                        stashRecords[globalIndex].status = "decomposed";
                        count++;
                        keyCount += item.keyValue;
                    }
                });
                
                totalKeys += keyCount;
                openResultModal(
                    "批量分解成功",
                    `成功分解了 ${count} 个道具，获得了 ${keyCount} 个钥匙`
                );
                updateStats();
                renderStash();
            }

            function batchReceiveAll() {
                // 检查是否有可领取的道具
                let hasReceivable = false;
                let count = 0;
                stashRecords.forEach((item) => {
                    if (item.status === "normal") {
                        hasReceivable = true;
                        count++;
                    }
                });
                
                if (!hasReceivable) {
                    openResultModal(
                        "提示",
                        "暂存箱中没有可领取的道具"
                    );
                    return;
                }
                
                // 使用自定义弹窗替代confirm
                const modalContent = document.getElementById("modalContent");
                modalContent.innerHTML = `
                    <div style="font-weight:bold;margin-bottom:10px;">确认操作</div>
                    <p>确认领取暂存箱中的所有道具吗？<br>共有 ${count} 个道具可领取</p>
                    <div style="display:flex;justify-content:center;gap:10px;margin-top:15px;">
                        <button id="confirmBatchReceiveAllBtn" class="blue-btn" style="min-width:80px;padding:6px 12px;margin:0 5px;">确认</button>
                        <button id="cancelBatchReceiveAllBtn" class="blue-btn" style="background:#999;min-width:80px;padding:6px 12px;margin:0 5px;">取消</button>
                    </div>
                `;
                
                // 设置标题
                document.querySelector("#modal .modal-header").textContent = "批量领取确认";
                
                // 隐藏原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "none";
                
                // 显示弹窗背景
                const modalBg = document.getElementById("modalBg");
                modalBg.style.display = "block";
                document.body.style.overflow = "hidden"; // 防止背景滚动
                
                setTimeout(() => {
                    modalBg.style.opacity = "1";
                }, 10);
                
                // 显示弹窗并添加动画效果
                const modal = document.getElementById("modal");
                modal.style.display = "block";
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                
                setTimeout(() => {
                    modal.style.opacity = "1";
                    modal.style.transform = "scale(1)";
                    modal.style.webkitTransform = "scale(1)";
                    modal.style.mozTransform = "scale(1)";
                    modal.style.msTransform = "scale(1)";
                    modal.style.oTransform = "scale(1)";
                    
                    // 绑定确认和取消按钮事件
                    document.getElementById("confirmBatchReceiveAllBtn").onclick = confirmBatchReceiveAll;
                    document.getElementById("cancelBatchReceiveAllBtn").onclick = closeModal;
                }, 10);
            }

            function confirmBatchReceiveAll() {
                // 关闭确认弹窗
                // closeModal();
                
                // 恢复原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "block";
                
                // 执行批量领取操作
                let count = 0;
                stashRecords.forEach((item, idx) => {
                    if (item.status === "normal") {
                        stashRecords[idx].status = "received";
                        count++;
                    }
                });
                
                openResultModal(
                    "批量领取成功",
                    `成功领取了 ${count} 个道具，游戏虚拟道具将会在24小时内到账`
                );
                renderStash();
            }

            function batchDecomposeAll() {
                // 检查是否有可分解的道具
                let hasDecomposable = false;
                let keyCount = 0;
                let count = 0;
                stashRecords.forEach((item) => {
                    if (item.status === "normal") {
                        hasDecomposable = true;
                        keyCount += item.keyValue;
                        count++;
                    }
                });
                
                if (!hasDecomposable) {
                    openResultModal(
                        "提示",
                        "暂存箱中没有可分解的道具"
                    );
                    return;
                }
                
                // 使用自定义弹窗替代confirm
                const modalContent = document.getElementById("modalContent");
                modalContent.innerHTML = `
                    <div style="font-weight:bold;margin-bottom:10px;">确认操作</div>
                    <p>确认分解暂存箱中的所有道具吗？<br>共有 ${count} 个道具，预计可获得 ${keyCount} 个钥匙</p>
                    <div style="display:flex;justify-content:center;gap:10px;margin-top:15px;">
                        <button id="confirmBatchDecomposeAllBtn" class="blue-btn" style="min-width:80px;padding:6px 12px;margin:0 5px;">确认</button>
                        <button id="cancelBatchDecomposeAllBtn" class="blue-btn" style="background:#999;min-width:80px;padding:6px 12px;margin:0 5px;">取消</button>
                    </div>
                `;
                
                // 设置标题
                document.querySelector("#modal .modal-header").textContent = "批量分解确认";
                
                // 隐藏原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "none";
                
                // 显示弹窗背景
                const modalBg = document.getElementById("modalBg");
                modalBg.style.display = "block";
                document.body.style.overflow = "hidden"; // 防止背景滚动
                
                setTimeout(() => {
                    modalBg.style.opacity = "1";
                }, 10);
                
                // 显示弹窗并添加动画效果
                const modal = document.getElementById("modal");
                modal.style.display = "block";
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                
                setTimeout(() => {
                    modal.style.opacity = "1";
                    modal.style.transform = "scale(1)";
                    modal.style.webkitTransform = "scale(1)";
                    modal.style.mozTransform = "scale(1)";
                    modal.style.msTransform = "scale(1)";
                    modal.style.oTransform = "scale(1)";
                    
                    // 绑定确认和取消按钮事件
                    document.getElementById("confirmBatchDecomposeAllBtn").onclick = confirmBatchDecomposeAll;
                    document.getElementById("cancelBatchDecomposeAllBtn").onclick = closeModal;
                }, 10);
            }

            function confirmBatchDecomposeAll() {
                // 关闭确认弹窗
                // closeModal();
                
                // 恢复原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "block";
                
                // 执行批量分解操作
                let count = 0;
                let keyCount = 0;
                stashRecords.forEach((item, idx) => {
                    if (item.status === "normal") {
                        stashRecords[idx].status = "decomposed";
                        count++;
                        keyCount += item.keyValue;
                    }
                });
                
                totalKeys += keyCount;
                openResultModal(
                    "批量分解成功",
                    `成功分解了 ${count} 个道具，获得了 ${keyCount} 个钥匙`
                );
                updateStats();
                renderStash();
            }

            /*******************************************
             *   抽奖逻辑                              *
             *******************************************/
            function showModal(content) {
                const modalContent = document.getElementById("modalContent");
                modalContent.innerHTML = content;
                
                // 设置标题
                document.querySelector("#modal .modal-header").textContent = "中奖信息";
                
                // 显示原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "block";
                
                // 显示弹窗背景
                const modalBg = document.getElementById("modalBg");
                modalBg.style.display = "block";
                
                // 禁止背景滚动并添加modal-open类
                document.body.classList.add("modal-open");
                
                setTimeout(() => {
                    modalBg.style.opacity = "1";
                }, 10);
                
                // 显示弹窗并添加动画效果
                const modal = document.getElementById("modal");
                modal.style.display = "block";
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                
                setTimeout(() => {
                    modal.style.opacity = "1";
                    modal.style.transform = "scale(1)";
                    modal.style.webkitTransform = "scale(1)";
                    modal.style.mozTransform = "scale(1)";
                    modal.style.msTransform = "scale(1)";
                    modal.style.oTransform = "scale(1)";
                }, 10);
                
                // 确保弹窗不会自动关闭，只能通过点击确定按钮关闭
                document.querySelector("#modal .modal-footer button").onclick = closeModal;
            }

            function openResultModal(title, htmlContent) {
                const modalContent = document.getElementById("modalContent");
                modalContent.innerHTML = `<div style="font-weight:bold;margin-bottom:10px;">${title}</div>${htmlContent}`;
                
                // 设置标题
                document.querySelector("#modal .modal-header").textContent = "操作结果";
                
                // 显示原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "block";
                
                // 显示弹窗背景
                const modalBg = document.getElementById("modalBg");
                modalBg.style.display = "block";
                
                // 禁止背景滚动并添加modal-open类
                document.body.classList.add("modal-open");
                
                setTimeout(() => {
                    modalBg.style.opacity = "1";
                }, 10);
                
                // 显示弹窗并添加动画效果
                const modal = document.getElementById("modal");
                modal.style.display = "block";
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                
                setTimeout(() => {
                    modal.style.opacity = "1";
                    modal.style.transform = "scale(1)";
                    modal.style.webkitTransform = "scale(1)";
                    modal.style.mozTransform = "scale(1)";
                    modal.style.msTransform = "scale(1)";
                    modal.style.oTransform = "scale(1)";
                }, 10);
                
                // 确保弹窗不会自动关闭，只能通过点击确定按钮关闭
                document.querySelector("#modal .modal-footer button").onclick = closeModal;
            }

            function closeModal() {
                // 添加关闭动画
                const modal = document.getElementById("modal");
                const modalBg = document.getElementById("modalBg");
                
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                modalBg.style.opacity = "0";
                
                // 恢复背景滚动并移除modal-open类
                document.body.classList.remove("modal-open");
                
                // 延迟隐藏弹窗
                setTimeout(() => {
                    modal.style.display = "none";
                    modalBg.style.display = "none";
                    
                    // 恢复原有的确定按钮显示
                    if (document.querySelector("#modal .modal-footer").style.display === "none") {
                        document.querySelector("#modal .modal-footer").style.display = "block";
                    }
                }, 300);
            }

            /*******************************************
             *   奖池概率                              *
             *******************************************/
            function openPrizePoolModal() {
                // 构建奖池概率表格
                const tableHTML = `
                    <table border="1" style="margin: 0 auto; border-collapse: collapse; width: 100%;">
                        <thead>
                            <tr>
                                <th style="padding: 10px; background-color: #4a76b5; color: white;">道具名称</th>
                                <th style="padding: 10px; background-color: #4a76b5; color: white;">奖池概率</th>
                                <th style="padding: 10px; background-color: #4a76b5; color: white;">分解所获钥匙</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${prizePool.map((item, index) => `
                                <tr ${index % 2 === 1 ? 'style="background-color: #f8f9fa;"' : ''}>
                                    <td style="padding: 8px; border: 1px solid #e0e0e0;">${item.name}</td>
                                    <td style="padding: 8px; border: 1px solid #e0e0e0; color: #ff3366; font-weight: bold;">${(item.prob).toFixed(2)}%</td>
                                    <td style="padding: 8px; border: 1px solid #e0e0e0; color: #007BFF; font-weight: bold;">${item.keyValue || '-'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                
                // 设置弹窗内容
                document.getElementById("prizePoolModalContent").innerHTML = tableHTML;
                document.querySelector("#prizePoolModal .modal-header").textContent = "奖池概率";
                
                // 显示弹窗背景
                const modalBg = document.getElementById("prizePoolModalBg");
                modalBg.style.display = "block";
                
                // 禁止背景滚动并添加modal-open类
                document.body.classList.add("modal-open");
                
                setTimeout(() => {
                    modalBg.style.opacity = "1";
                }, 10);
                
                // 显示弹窗并添加动画效果
                const modal = document.getElementById("prizePoolModal");
                modal.style.display = "block";
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                
                setTimeout(() => {
                    modal.style.opacity = "1";
                    modal.style.transform = "scale(1)";
                    modal.style.webkitTransform = "scale(1)";
                    modal.style.mozTransform = "scale(1)";
                    modal.style.msTransform = "scale(1)";
                    modal.style.oTransform = "scale(1)";
                }, 10);
                
                // 确保弹窗不会自动关闭
                document.querySelector("#prizePoolModal .modal-footer button").onclick = closePrizePoolModal;
            }

            function closePrizePoolModal() {
                // 添加关闭动画
                const modal = document.getElementById("prizePoolModal");
                const modalBg = document.getElementById("prizePoolModalBg");
                
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                modalBg.style.opacity = "0";
                
                // 恢复背景滚动并移除modal-open类
                document.body.classList.remove("modal-open");
                
                // 延迟隐藏弹窗
                setTimeout(() => {
                    modal.style.display = "none";
                    modalBg.style.display = "none";
                }, 300);
            }

            /*******************************************
             *   礼包记录                              *
             *******************************************/
            function renderGiftRecords() {
                const tableBody = document.getElementById("giftHistoryTableBody");
                tableBody.innerHTML = "";
                
                const totalPages = Math.ceil(giftRecords.length / giftPageSize) || 1;
                const currentPage = Math.min(Math.max(giftCurrentPage, 1), totalPages);
                const startIndex = (currentPage - 1) * giftPageSize;
                const endIndex = Math.min(startIndex + giftPageSize, giftRecords.length);
                const pageData = giftRecords.slice(startIndex, endIndex);
                
                pageData.forEach((record) => {
                    const row = document.createElement("tr");
                    const timeTd = document.createElement("td");
                    timeTd.textContent = record.time;
                    const regionTd = document.createElement("td");
                    regionTd.textContent = record.region;
                    const itemTd = document.createElement("td");
                    itemTd.textContent = record.item;
                    row.appendChild(timeTd);
                    row.appendChild(regionTd);
                    row.appendChild(itemTd);
                    tableBody.appendChild(row);
                });
                
                const pageInfo = document.getElementById("giftPageInfo");
                pageInfo.textContent = `${currentPage}/${totalPages}`;
            }

            function prevGiftPage() {
                if (giftCurrentPage > 1) {
                giftCurrentPage--;
                renderGiftRecords();
            }
            }

            function nextGiftPage() {
                const totalPages = Math.ceil(giftRecords.length / giftPageSize) || 1;
                if (giftCurrentPage < totalPages) {
                giftCurrentPage++;
                    renderGiftRecords();
                }
            }

            function addGiftRecord(item) {
                // 添加记录到礼包记录
                giftRecords.unshift({
                    time: new Date().toLocaleString(),
                    region: userRegion,
                    item: item,
                });
                
                // 重置到第一页并重新渲染
                giftCurrentPage = 1;
                renderGiftRecords();
            }

            /*******************************************
             *   统计信息                              *
             *******************************************/
            function updateStats() {
                // 修复变量名冲突，使用不同的变量名
                const moneyDisplay = moneySpent.toFixed(2);
                const keysDisplay = totalKeys.toString();
                const coinsDisplay = totalCoins.toString();
                const drawsDisplay = totalDraws.toString();
                const boxCountDisplay = starBoxCount.toString();
                const valueDisplay = starValue.toString();

                document.getElementById("totalMoney").textContent = moneyDisplay;
                document.getElementById("totalKeys").textContent = keysDisplay;
                document.getElementById("totalCoins").textContent = coinsDisplay;
                document.getElementById("totalDraws").textContent = drawsDisplay;
                document.getElementById("starBoxCount").textContent = boxCountDisplay;
                document.getElementById("starValue").textContent = valueDisplay;
                
                // 同步更新兑换区域的星辰币显示
                document.getElementById("totalCoinsDisplay").textContent = coinsDisplay;
            }

            /*******************************************
             *   星耀宝箱和星耀值兑换                    *
             *******************************************/
            function openStarBox(times) {
                if (starBoxCount < times) {
                    openResultModal("提示", "星耀宝箱数量不足，请先获取宝箱！");
                    return;
                }
                
                // 获取选中的选项
                const options = document.getElementsByName("starBoxOption");
                let selectedValue = "";
                for (let i = 0; i < options.length; i++) {
                    if (options[i].checked) {
                        selectedValue = options[i].value;
                        break;
                    }
                }
                
                if (!selectedValue) {
                    openResultModal("提示", "请先选择一个奖励选项！");
                    return;
                }
                
                // 处理不同的选项
                let rewardName = "";
                if (selectedValue === "xyValue") {
                    starValue += 3 * times;
                    rewardName = `星耀值x${3 * times}`;
                } else if (selectedValue === "kingStone") {
                    rewardName = `王者之石x${times}`;
                } else if (selectedValue === "universalFrag") {
                    rewardName = `2025万能碎片x${3 * times}`;
                }
                
                // 减少宝箱数量
                starBoxCount -= times;
                
                // 更新显示
                document.getElementById("starBoxCount").textContent = starBoxCount;
                document.getElementById("starValue").textContent = starValue;
                
                // 显示结果
                openResultModal(
                    "领取成功",
                    `成功开启 ${times} 个星耀宝箱，获得 ${rewardName}`
                );
            }

            function exchangeStarValue(itemName, cost) {
                if (starValue < cost) {
                    openResultModal("提示", "星耀值不足，无法兑换！");
                    return;
                }
                
                // 使用自定义弹窗替代confirm
                const modalContent = document.getElementById("modalContent");
                modalContent.innerHTML = `
                    <div style="font-weight:bold;margin-bottom:10px;">确认兑换</div>
                    <p>确定使用【${cost}】个星耀值兑换【${itemName}】吗？</p>
                    <div style="display:flex;justify-content:center;gap:10px;margin-top:15px;">
                        <button id="confirmStarValueExchangeBtn" class="blue-btn" style="min-width:80px;padding:6px 12px;margin:0 5px;">确认</button>
                        <button id="cancelStarValueExchangeBtn" class="blue-btn" style="background:#999;min-width:80px;padding:6px 12px;margin:0 5px;">取消</button>
                    </div>
                `;
                
                // 设置标题
                document.querySelector("#modal .modal-header").textContent = "兑换确认";
                
                // 隐藏原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "none";
                
                // 显示弹窗背景
                const modalBg = document.getElementById("modalBg");
                modalBg.style.display = "block";
                document.body.style.overflow = "hidden"; // 防止背景滚动
                
                setTimeout(() => {
                    modalBg.style.opacity = "1";
                }, 10);
                
                // 显示弹窗并添加动画效果
                const modal = document.getElementById("modal");
                modal.style.display = "block";
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                
                setTimeout(() => {
                    modal.style.opacity = "1";
                    modal.style.transform = "scale(1)";
                    modal.style.webkitTransform = "scale(1)";
                    modal.style.mozTransform = "scale(1)";
                    modal.style.msTransform = "scale(1)";
                    modal.style.oTransform = "scale(1)";
                    
                    // 绑定确认和取消按钮事件
                    document.getElementById("confirmStarValueExchangeBtn").onclick = function() {
                        confirmStarValueExchange(itemName, cost);
                    };
                    document.getElementById("cancelStarValueExchangeBtn").onclick = closeModal;
                }, 10);
            }
            
            function confirmStarValueExchange(itemName, cost) {
                // 关闭确认弹窗，但不使用动画效果，立即关闭
                const modal = document.getElementById("modal");
                const modalBg = document.getElementById("modalBg");
                
                // 立即隐藏弹窗，不使用动画
                modal.style.display = "none";
                modalBg.style.display = "none";
                
                // 恢复原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "block";
                
                // 执行兑换操作
                // 扣除星耀值
                starValue -= cost;
                document.getElementById("starValue").textContent = starValue;
                
                // 添加到礼包记录
                addGiftRecord(itemName);
                
                // 显示结果
                openResultModal(
                    "兑换成功",
                    `成功兑换 ${itemName}，消耗 ${cost} 星耀值`
                );
            }

            /*******************************************
             *   星辰币兑换                              *
             *******************************************/
            function exchangeStarCoin(itemName, cost) {
                if (totalCoins < cost) {
                    openResultModal("提示", "星辰币不足，无法兑换！");
                    return;
                }
                
                // 使用自定义弹窗替代confirm
                const modalContent = document.getElementById("modalContent");
                modalContent.innerHTML = `
                    <div style="font-weight:bold;margin-bottom:10px;">确认兑换</div>
                    <p>确定使用【${cost}】个星辰币兑换【${itemName}】吗？</p>
                    <div style="display:flex;justify-content:center;gap:10px;margin-top:15px;">
                        <button id="confirmExchangeBtn" class="blue-btn" style="min-width:80px;padding:6px 12px;margin:0 5px;">确认</button>
                        <button id="cancelExchangeBtn" class="blue-btn" style="background:#999;min-width:80px;padding:6px 12px;margin:0 5px;">取消</button>
                    </div>
                `;
                
                // 设置标题
                document.querySelector("#modal .modal-header").textContent = "兑换确认";
                
                // 隐藏原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "none";
                
                // 显示弹窗背景
                const modalBg = document.getElementById("modalBg");
                modalBg.style.display = "block";
                document.body.style.overflow = "hidden"; // 防止背景滚动
                
                setTimeout(() => {
                    modalBg.style.opacity = "1";
                }, 10);
                
                // 显示弹窗并添加动画效果
                const modal = document.getElementById("modal");
                modal.style.display = "block";
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                
                setTimeout(() => {
                    modal.style.opacity = "1";
                    modal.style.transform = "scale(1)";
                    modal.style.webkitTransform = "scale(1)";
                    modal.style.mozTransform = "scale(1)";
                    modal.style.msTransform = "scale(1)";
                    modal.style.oTransform = "scale(1)";
                    
                    // 绑定确认和取消按钮事件
                    document.getElementById("confirmExchangeBtn").onclick = function() {
                        confirmExchange(itemName, cost);
                    };
                    document.getElementById("cancelExchangeBtn").onclick = closeModal;
                }, 10);
            }
            
            function confirmExchange(itemName, cost) {
                // 关闭确认弹窗，但不使用动画效果，立即关闭
                const modal = document.getElementById("modal");
                const modalBg = document.getElementById("modalBg");
                
                // 立即隐藏弹窗，不使用动画
                modal.style.display = "none";
                modalBg.style.display = "none";
                
                // 恢复原有的确定按钮
                document.querySelector("#modal .modal-footer").style.display = "block";
                
                // 执行兑换操作
                // 扣除星辰币
                totalCoins -= cost;
                document.getElementById("totalCoins").textContent = totalCoins;
                document.getElementById("totalCoinsDisplay").textContent = totalCoins;
                
                // 添加到礼包记录
                addGiftRecord(itemName);
                
                // 显示结果
                openResultModal(
                    "兑换成功",
                    `成功兑换 ${itemName}，消耗 ${cost} 星辰币`
                );
            }

            /*******************************************
             *   保底价格                              *
             *******************************************/
            // 保底价格数据（通过模拟计算得出）
            const guaranteedPriceData = [
                { name: "Kar98K-星神", coinCost: 1188, price: 1440, keyCount: 158 },
                { name: "幻神-星耀 皮肤", coinCost: 958, price: 1170, keyCount: 128 },
                { name: "星际战将", coinCost: 958, price: 1170, keyCount: 128 },
                { name: "毁灭-星耀 皮肤", coinCost: 758, price: 930, keyCount: 102 },
                { name: "Kar98K-星神音效卡", coinCost: 758, price: 930, keyCount: 102 },
                { name: "屠龙-星耀 皮肤", coinCost: 558, price: 690, keyCount: 75 },
                { name: "AN94-超新星", coinCost: 278, price: 350, keyCount: 38 },
                { name: "AK12-天启", coinCost: 248, price: 310, keyCount: 34 },
                { name: "炼狱-星空 皮肤", coinCost: 198, price: 260, keyCount: 28 },
                { name: "羊驼玩偶", coinCost: 108, price: 140, keyCount: 15 }
            ];

            function openGuaranteedPriceModal() {
                // 构建保底价格表格
                const tableHTML = `
                    <div class="guaranteed-price-table">
                        <div class="guaranteed-price-row header">
                            <div class="guaranteed-price-cell">抽取次数</div>
                            <div class="guaranteed-price-cell">保底价格</div>
                        </div>
                        <div class="guaranteed-price-row">
                            <div class="guaranteed-price-cell">1-10次</div>
                            <div class="guaranteed-price-cell">无保底</div>
                        </div>
                        <div class="guaranteed-price-row">
                            <div class="guaranteed-price-cell">11-30次</div>
                            <div class="guaranteed-price-cell">1000元</div>
                        </div>
                        <div class="guaranteed-price-row">
                            <div class="guaranteed-price-cell">31-50次</div>
                            <div class="guaranteed-price-cell">800元</div>
                        </div>
                        <div class="guaranteed-price-row">
                            <div class="guaranteed-price-cell">51-80次</div>
                            <div class="guaranteed-price-cell">600元</div>
                        </div>
                        <div class="guaranteed-price-row">
                            <div class="guaranteed-price-cell">81-100次</div>
                            <div class="guaranteed-price-cell">400元</div>
                        </div>
                        <div class="guaranteed-price-row">
                            <div class="guaranteed-price-cell">101次以上</div>
                            <div class="guaranteed-price-cell">200元</div>
                        </div>
                    </div>
                    <div class="guaranteed-price-note">
                        注：保底价格是指在对应抽取次数范围内，如果抽中了幻神-星辰所向，系统会自动以保底价格回收。
                    </div>
                `;
                
                // 设置弹窗内容
                document.getElementById("guaranteedPriceModalContent").innerHTML = tableHTML;
                
                // 显示弹窗背景
                const modalBg = document.getElementById("guaranteedPriceModalBg");
                modalBg.style.display = "block";
                
                // 禁止背景滚动并添加modal-open类
                document.body.classList.add("modal-open");
                
                setTimeout(() => {
                    modalBg.style.opacity = "1";
                }, 10);
                
                // 显示弹窗并添加动画效果
                const modal = document.getElementById("guaranteedPriceModal");
                modal.style.display = "block";
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                
                setTimeout(() => {
                    modal.style.opacity = "1";
                    modal.style.transform = "scale(1)";
                    modal.style.webkitTransform = "scale(1)";
                    modal.style.mozTransform = "scale(1)";
                    modal.style.msTransform = "scale(1)";
                    modal.style.oTransform = "scale(1)";
                }, 10);
                
                // 确保弹窗不会自动关闭
                document.querySelector("#guaranteedPriceModal .modal-footer button").onclick = closeGuaranteedPriceModal;
            }

            function closeGuaranteedPriceModal() {
                // 添加关闭动画
                const modal = document.getElementById("guaranteedPriceModal");
                const modalBg = document.getElementById("guaranteedPriceModalBg");
                
                modal.style.opacity = "0";
                modal.style.transform = "scale(0.9)";
                modal.style.webkitTransform = "scale(0.9)";
                modal.style.mozTransform = "scale(0.9)";
                modal.style.msTransform = "scale(0.9)";
                modal.style.oTransform = "scale(0.9)";
                modalBg.style.opacity = "0";
                
                // 恢复背景滚动并移除modal-open类
                document.body.classList.remove("modal-open");
                
                // 延迟隐藏弹窗
                setTimeout(() => {
                    modal.style.display = "none";
                    modalBg.style.display = "none";
                }, 300);
            }
        </script>
    </body>
</html>